# t-gif6.trc: GIF Unit Test - IMT Mode Transfers ----------

# Verify IMT mode transfers
#   Specific Tests 
#     1. IMT bursts at 8 quadwords
#     2. GIF_STAT.IMT not set until EOP processed
#     3. GIF_STAT.IMT not reset until EOP processed
#        and PATH2 DIRECT_HL transfer ignored by arbiter
#     4. Queue multiple IMT requests on PATH3 
#     5. Verify End of Primitive/Packet is still a  
#        reschedule point 
	 
C t-gif6 Test 1 - BEGIN
#----------------------------------------------------------
# 1. Scenario: Set GIF_MODE.IMT 
#              Data on PATH3 ((NLOOP=16) == 2 bursts)
#              Data on PATH2
#              Should see PATH3 8 quadwords transfer
#                         PATH2 data transfer
#                         PATH3 8 quadwords transfer
#----------------------------------------------------------
#
# Turn on GIF_MODE.IMT ( and verify )
! 0xb0003010 0x00000004
? 0xb0003020 0x00000004 0xffffffff
#
# PATH3: GIF tag: Image mode, EOP = 1, nloop = 16
4 0x00000000_00000000_08000000_00008010 0x00000000
# PATH3: Data
4 0x11222221_11222222_11111110_11111111 0x00000000
4 0x11444441_11444444_11333330_11333333 0x00000000
4 0x11666661_11666666_11555550_11555555 0x00000000
4 0x11888881_11888888_11777770_11777777 0x00000000
4 0x12222221_12222222_12111110_12111111 0x00000000
4 0x12444441_12444444_12333330_12333333 0x00000000
4 0x12666661_12666666_12555550_12555555 0x00000000
4 0x12888881_12888888_12777770_12777777 0x00000000
#
# PATH2: GIF tag: Image mode, EOP = 1, nloop = 2
3 0x00000000_00000000_08000000_00008002 0x00000000
# PATH2: Data
3 0x0ddddddd_cccccccc_0bbbbbbb_aaaaaaaa 0x00000000
3 0x1ddddddd_cccccccc_1bbbbbbb_aaaaaaaa 0x00000000
#
# PATH3: Data
4 0x21222221_21222222_21111110_21111111 0x00000000
4 0x21444441_21444444_21333330_21333333 0x00000000
4 0x21666661_21666666_21555550_21555555 0x00000000
4 0x21888881_21888888_21777770_21777777 0x00000000
4 0x22222221_22222222_22111110_22111111 0x00000000
4 0x22444441_22444444_22333330_22333333 0x00000000
4 0x22666661_22666666_22555550_22555555 0x00000000
4 0x22888881_22888888_22777770_22777777 0x00000000

C t-gif6 Test 1 - END

C t-gif6 Test 2 - BEGIN
#----------------------------------------------------------
# 2. Scenario: Data on PATH2 
#              Set GIF_MODE.IMT in middle of PACKET
#              Verify GIF_MODE.IMT is not set until EOP
#----------------------------------------------------------
#
# Turn off GIF_STAT.IMT ( by hitting ~GIF_MODE.IMT )
! 0xb0003010 0x00000000
? 0xb0003020 0x00000000	0xffffffff
#
# PATH2: GIF tag: Image mode, EOP = 0, nloop = 2
3 0x00000000_00000000_08000000_00000002 0x00000000
# PATH2: Data
3 0x0ddddddd_cccccccc_0bbbbbbb_aaaaaaaa 0x00000000
#
# Turn on GIF_MODE.IMT ( and verify NOT SET )
! 0xb0003010 0x00000004
? 0xb0003020 0x00000b40	0xffffffff
#
3 0x1ddddddd_cccccccc_1bbbbbbb_aaaaaaaa 0x00000000
#
# Verify GIF_STAT.IMT NOT ON after end of primitive
? 0xb0003020 0x00000b40	0xffffffff
#
# PATH2: GIF tag: Image mode, EOP = 1, nloop = 2
3 0x00000000_00000000_08000000_00008002 0x00000000
# PATH2: Data
3 0x2ddddddd_cccccccc_2bbbbbbb_aaaaaaaa 0x00000000
3 0x3ddddddd_cccccccc_3bbbbbbb_aaaaaaaa 0x00000000
#
# Verify GIF_STAT.IMT ON at EOP
#  GIF_STAT.IMT (IDLE)
? 0xb0003020 0x00000004	0xffffffff
#
# PATH3: GIF tag: Image mode, EOP = 1, nloop = 8
4 0x00000000_00000000_08000000_00008008 0x00000000
#
# Verify GIF_STAT.IMT still ON
#  GIF_STAT.APATH.OPH.IMT
? 0xb0003020 0x00000e04	0xffffffff
#
# PATH3: Data
4 0x11222221_11222222_11111110_11111111 0x00000000
4 0x11444441_11444444_11333330_11333333 0x00000000
4 0x11666661_11666666_11555550_11555555 0x00000000
4 0x11888881_11888888_11777770_11777777 0x00000000
4 0x12222221_12222222_12111110_12111111 0x00000000
4 0x12444441_12444444_12333330_12333333 0x00000000
4 0x12666661_12666666_12555550_12555555 0x00000000
4 0x12888881_12888888_12777770_12777777 0x00000000
#
# Turn off GIF_STAT.IMT ( by hitting ~GIF_MODE.IMT )
! 0xb0003010 0x00000000
? 0xb0003020 0x00000000	0xffffffff

C t-gif6 Test 2 - END

C t-gif6 Test 3 - BEGIN
#----------------------------------------------------------
# 3. Scenario: Data on PATH3 (IMT NLOOP=16 first 8) 
#              Transfer PATH2 direct_hl
#	       Transfer PATH1
#              Data on PATH3 ( IMT second 8 )
#              Turn off GIF_MODE.IMT
#              Should see:  PATH3 8 quadword burst
#                           PATH1 transfer
#                           PATH3 8 quadword burst
#                           PATH2 direct_hl transfer
#               
#----------------------------------------------------------
#
# Turn on GIF_MODE.IMT ( and verify )
! 0xb0003010 0x00000004
? 0xb0003020 0x00000004 0xffffffff
#
# PATH3: GIF tag: Image mode, EOP = 1, nloop = 16
4 0x00000000_00000000_08000000_00008010 0x00000000
# PATH3: Data
4 0x11222221_11222222_11111110_11111111 0x00000000
4 0x11444441_11444444_11333330_11333333 0x00000000
4 0x11666661_11666666_11555550_11555555 0x00000000
4 0x11888881_11888888_11777770_11777777 0x00000000
4 0x12222221_12222222_12111110_12111111 0x00000000
4 0x12444441_12444444_12333330_12333333 0x00000000
4 0x12666661_12666666_12555550_12555555 0x00000000
4 0x12888881_12888888_12777770_12777777 0x00000000
#
# Perform a DIRECT_HL on PATH2
1 0x5100000b_00000000_00000000_00000000 0x00000000 
# PATH2: GIF tag: Packed mode, A_D, nloop=10, EOP
1 0x00000000_0000000e_10000000_0000800a 0x00000000 
# PATH2: Data
1 0x00000000_0000004c_00000000_000a0000 0x00000000 
1 0x00000000_00000040_01df0000_027f0000 0x00000000 
1 0x00000000_00000018_00007100_00006c00 0x00000000 
1 0x00000000_0000001a_00000000_00000001 0x00000000 
1 0x00000000_0000004e_00000000_01000096 0x00000000 
1 0x00000000_00000047_00000000_00070000 0x00000000 
1 0x00000000_00000046_00000000_00000001 0x00000000 
1 0x00000000_00000048_00000000_00000000 0x00000000 
1 0x00000000_00000049_01e00280_00000000 0x00000000 
1 0x00000000_00000050_00000000_00000003 0x00000000 
#
# PATH1: GIF tag: Image mode, EOP = 1, nloop = 2
2 0x00000000_00000000_08000000_00008002 0x00000000
# PATH1: Data
2 0xabababab_abababab_cdcdcdcd_cdcdcdcd 0x00000000
2 0xefefefef_efefefef_a1a1a1a1_a1a1a1a1 0x00000000
#
# PATH3: Data
4 0x21222221_21222222_21111110_21111111 0x00000000
4 0x21444441_21444444_21333330_21333333 0x00000000
4 0x21666661_21666666_21555550_21555555 0x00000000
4 0x21888881_21888888_21777770_21777777 0x00000000
4 0x22222221_22222222_22111110_22111111 0x00000000
4 0x22444441_22444444_22333330_22333333 0x00000000
4 0x22666661_22666666_22555550_22555555 0x00000000
4 0x22888881_22888888_22777770_22777777 0x00000000
#
# Turn off GIF_MODE.IMT ( and verify )
! 0xb0003010 0x00000000
? 0xb0003020 0x00000000 0xffffffff

C t-gif6 Test 3 - END

C t-gif6 Test 4 - BEGIN
#----------------------------------------------------------
# 4. Scenario: Data on PATH2
#              Queue data on PATH3 (IMT NLOOP=16) (Transfer 8)
#	       Data on PATH2 EOP
#	       Queue data on PATH1
#              Queue data on PATH3 (IMT NLOOP=16) (Transfer 8)
#              Queue data on PATH3 (IMT NLOOP=16) (Transfer 16)
#	       Data on PATH1 EOP
#              Should see:  PATH2 packet transfer
#                           PATH3 IMT burst
#                           PATH1 packet transfer
#                           PATH3 IMT burst
#                           PATH3 IMT burst
#                           PATH3 IMT burst
#               
#----------------------------------------------------------
#
# Perform a DIRECT_HL on PATH2
1 0x5100000b_00000000_00000000_00000000 0x00000000 
# PATH2: GIF tag: Packed mode, A_D, nloop=10
1 0x00000000_0000000e_10000000_0000000a 0x00000000 
# PATH2: Data
1 0x00000000_0000004c_00000000_000a0000 0x00000000 
1 0x00000000_00000040_01df0000_027f0000 0x00000000 
1 0x00000000_00000018_00007100_00006c00 0x00000000 
1 0x00000000_0000001a_00000000_00000001 0x00000000 
1 0x00000000_0000004e_00000000_01000096 0x00000000 
1 0x00000000_00000047_00000000_00070000 0x00000000 
1 0x00000000_00000046_00000000_00000001 0x00000000 
1 0x00000000_00000048_00000000_00000000 0x00000000 
1 0x00000000_00000049_01e00280_00000000 0x00000000 
1 0x00000000_00000050_00000000_00000003 0x00000000

# Turn on GIF_MODE.IMT ( and verify )
! 0xb0003010 0x00000004
? 0xb0003020 0x00000b40 0xffffffff

# PATH3: GIF tag: Image mode, EOP = 1, nloop = 16
4 0x00000000_00000000_08000000_00008010 0x00000000
# PATH3: Data
4 0x00000000_11222222_00000000_11111111 0x00000000
4 0x00000000_11444444_00000000_11333333 0x00000000
4 0x00000000_11666666_00000000_11555555 0x00000000
4 0x00000000_11888888_00000000_11777777 0x00000000
4 0x00000000_12222222_00000000_12111111 0x00000000
4 0x00000000_12444444_00000000_12333333 0x00000000
4 0x00000000_12666666_00000000_12555555 0x00000000
4 0x00000000_12888888_00000000_12777777 0x00000000

# Perform a DIRECT_HL on PATH2
1 0x5100000b_00000000_00000000_00000000 0x00000000 
# PATH2: GIF tag: Packed mode, A_D, nloop=10, EOP
1 0x00000000_0000000e_10000000_0000800a 0x00000000 
# PATH2: Data
1 0x00000000_0000004c_ffffffff_00000000 0x00000000 
1 0x00000000_00000040_ffffffff_00000001 0x00000000 
1 0x00000000_00000018_ffffffff_00000002 0x00000000 
1 0x00000000_0000001a_ffffffff_00000003 0x00000000 
1 0x00000000_0000004e_ffffffff_00000004 0x00000000 
1 0x00000000_00000047_ffffffff_00000005 0x00000000 
1 0x00000000_00000046_ffffffff_00000006 0x00000000 
1 0x00000000_00000048_ffffffff_00000007 0x00000000 
1 0x00000000_00000049_ffffffff_00000008 0x00000000 
1 0x00000000_00000050_ffffffff_00000009 0x00000000 

# Turn on GIF_MODE.IMT ( and verify )
! 0xb0003010 0x00000004
? 0xb0003020 0x00000004 0xffffffff

# PATH1: GIF tag: Image mode, nloop = 2
2 0x00000000_00000000_08000000_00000002 0x00000000
# PATH1: Data
2 0xabababab_abababab_cdcdcdcd_cdcdcdcd 0x00000000
2 0xefefefef_efefefef_a1a1a1a1_a1a1a1a1 0x00000000

# PATH3: Data
4 0x11111111_21222222_11111111_21111111 0x00000000
4 0x11111111_21444444_11111111_21333333 0x00000000
4 0x11111111_21666666_11111111_21555555 0x00000000
4 0x11111111_21888888_11111111_21777777 0x00000000
4 0x11111111_22222222_11111111_22111111 0x00000000
4 0x11111111_22444444_11111111_22333333 0x00000000
4 0x11111111_22666666_11111111_22555555 0x00000000
4 0x11111111_22888888_11111111_22777777 0x00000000

# PATH3: GIF tag: Image mode, EOP = 1, nloop = 16
4 0x00000000_00000000_08000000_00008010 0x00000000
# PATH3: Data
4 0x22222222_11222222_22222222_11111111 0x00000000
4 0x22222222_11444444_22222222_11333333 0x00000000
4 0x22222222_11666666_22222222_11555555 0x00000000
4 0x22222222_11888888_22222222_11777777 0x00000000
4 0x22222222_12222222_22222222_12111111 0x00000000
4 0x22222222_12444444_22222222_12333333 0x00000000
4 0x22222222_12666666_22222222_12555555 0x00000000
4 0x22222222_12888888_22222222_12777777 0x00000000
4 0x33333333_11222222_33333333_11111111 0x00000000
4 0x33333333_11444444_33333333_11333333 0x00000000
4 0x33333333_11666666_33333333_11555555 0x00000000
4 0x33333333_11888888_33333333_11777777 0x00000000
4 0x33333333_12222222_33333333_12111111 0x00000000
4 0x33333333_12444444_33333333_12333333 0x00000000
4 0x33333333_12666666_33333333_12555555 0x00000000
4 0x33333333_12888888_33333333_12777777 0x00000000

 PATH1: GIF tag: Image mode, nloop = 2
2 0x00000000_00000000_08000000_00008002 0x00000000
# PATH1: Data
2 0xabababab_abababab_cdcdcdcd_cdcdcdcd 0x00000000
2 0xefefefef_efefefef_a1a1a1a1_a1a1a1a1 0x00000000

# Turn off GIF_MODE.IMT ( and verify )
! 0xb0003010 0x00000000
? 0xb0003020 0x00000000 0xffffffff

C t-gif6 Test 4 - END

C t-gif6 Test 5 - BEGIN
#----------------------------------------------------------
# 5. Scenario: Data on PATH2
#              Data on PATH3 (IMT NLOOP=4 )
#	       Data on PATH2 EOP
#	       Queue data on PATH1
#              Queue data on PATH3 (IMT NLOOP=9)  
#	       Data on PATH1 EOP
#              Should see:  PATH2 packet transfer
#                           PATH3 IMT burst - 4 quadwords
#                           PATH1 packet transfer
#                           PATH3 IMT burst - 8 quadwords
#                           PATH3 IMT burst - 1 quadword
#                                         
#----------------------------------------------------------
#
# Perform a DIRECT_HL on PATH2
1 0x5100000b_00000000_00000000_00000000 0x00000000 
# PATH2: GIF tag: Packed mode, A_D, nloop=10
1 0x00000000_0000000e_10000000_0000000a 0x00000000 
# PATH2: Data
1 0x00000000_0000004c_00000000_000a0000 0x00000000 
1 0x00000000_00000040_01df0000_027f0000 0x00000000 
1 0x00000000_00000018_00007100_00006c00 0x00000000 
1 0x00000000_0000001a_00000000_00000001 0x00000000 
1 0x00000000_0000004e_00000000_01000096 0x00000000 
1 0x00000000_00000047_00000000_00070000 0x00000000 
1 0x00000000_00000046_00000000_00000001 0x00000000 
1 0x00000000_00000048_00000000_00000000 0x00000000 
1 0x00000000_00000049_01e00280_00000000 0x00000000 
1 0x00000000_00000050_00000000_00000003 0x00000000

# Turn on GIF_MODE.IMT ( and verify )
! 0xb0003010 0x00000004
? 0xb0003020 0x00000b40 0xffffffff

# PATH3: GIF tag: Image mode, EOP, nloop = 4
4 0x00000000_00000000_08000000_00008004 0x00000000
# PATH3: Data
4 0x00000000_11222222_00000000_11111111 0x00000000
4 0x00000000_11444444_00000000_11333333 0x00000000
4 0x00000000_11666666_00000000_11555555 0x00000000
4 0x00000000_11888888_00000000_11777777 0x00000000

# Perform a DIRECT_HL on PATH2
1 0x5100000b_00000000_00000000_00000000 0x00000000 
# PATH2: GIF tag: Packed mode, A_D, nloop=10, EOP
1 0x00000000_0000000e_10000000_0000800a 0x00000000 
# PATH2: Data
1 0x00000000_0000004c_ffffffff_00000000 0x00000000 
1 0x00000000_00000040_ffffffff_00000001 0x00000000 
1 0x00000000_00000018_ffffffff_00000002 0x00000000 
1 0x00000000_0000001a_ffffffff_00000003 0x00000000 
1 0x00000000_0000004e_ffffffff_00000004 0x00000000 
1 0x00000000_00000047_ffffffff_00000005 0x00000000 
1 0x00000000_00000046_ffffffff_00000006 0x00000000 
1 0x00000000_00000048_ffffffff_00000007 0x00000000 
1 0x00000000_00000049_ffffffff_00000008 0x00000000 
1 0x00000000_00000050_ffffffff_00000009 0x00000000 

# PATH1: GIF tag: Image mode, nloop = 2
2 0x00000000_00000000_08000000_00000002 0x00000000
# PATH1: Data
2 0xabababab_abababab_cdcdcdcd_cdcdcdcd 0x00000000
2 0xefefefef_efefefef_a1a1a1a1_a1a1a1a1 0x00000000


# PATH3: GIF tag: Image mode, EOP, nloop = 9
4 0x00000000_00000000_08000000_00008009 0x00000000
# PATH3: Data
4 0x22222222_11222222_22222222_11111111 0x00000000
4 0x22222222_11444444_22222222_11333333 0x00000000
4 0x22222222_11666666_22222222_11555555 0x00000000
4 0x22222222_11888888_22222222_11777777 0x00000000
4 0x22222222_12222222_22222222_12111111 0x00000000
4 0x22222222_12444444_22222222_12333333 0x00000000
4 0x22222222_12666666_22222222_12555555 0x00000000
4 0x22222222_12888888_22222222_12777777 0x00000000
4 0x33333333_11222222_33333333_11111111 0x00000000

 PATH1: GIF tag: Image mode, nloop = 2, EOP 
2 0x00000000_00000000_08000000_00008002 0x00000000
# PATH1: Data
2 0xabababab_abababab_cdcdcdcd_cdcdcdcd 0x00000000
2 0xefefefef_efefefef_a1a1a1a1_a1a1a1a1 0x00000000

# Turn off GIF_MODE.IMT ( and verify )
! 0xb0003010 0x00000000
? 0xb0003020 0x00000000 0xffffffff

C t-gif6 Test 5 - END
